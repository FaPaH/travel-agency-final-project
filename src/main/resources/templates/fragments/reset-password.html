<div th:fragment="reset-password-fragment" id="reset-container" class="p-3 border rounded bg-light">

    <div th:if="${success}" class="alert alert-success">
        <h5 class="alert-heading">Ready!</h5>
        <p th:text="${message}"></p>
        <button class="btn btn-sm btn-outline-secondary"
                th:attr="hx-get=@{/user/profile/{id}(id=${#authentication.principal.id})}"
                hx-target="#content-area">Back to profile</button>
    </div>

    <div th:if="${success == null}">
        <h4>Password reset</h4>

        <form th:object="${resetRequest}"
              hx-post="/auth/reset-password"
              hx-target="#reset-container"
              hx-swap="outerHTML"
              hx-indicator="#loading-spinner"
              hx-disabled-elt="find button">

            <div th:if="${!hasEmail}" class="mb-3">
                <p class="text-warning">
                    There is no email in your profile. Please, provide email for reset link:</p>
                <input type="email"
                       th:field="*{email}"
                       class="form-control"
                       placeholder="your-email@example.com"
                       th:classappend="${#fields.hasErrors('email')} ? 'is-invalid' : ''"
                       required>
                <div class="invalid-feedback" th:errors="*{email}">Email error</div>
            </div>

            <div th:if="${hasEmail}" class="mb-3">
                <p> Reset link was sent to your email:
                    <strong th:text="${resetRequest.email}"></strong>
                </p>
                <input type="hidden" th:field="*{email}">
            </div>

            <div class="d-flex align-items-center gap-3">
                <button type="submit" class="btn btn-danger">
                    [[${hasEmail} ? 'Send email' : 'Accept email and send']]
                </button>

                <div id="loading-spinner" class="htmx-indicator text-primary">
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    <span class="ms-1">Sending request...</span>
                </div>
            </div>

        </form>
    </div>
</div>